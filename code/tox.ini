[tox]
envlist = py310,py311,py312,lint,type
isolated_build = true
requires = tox-uv

[testenv]
description = Run tests with pytest
package = wheel
wheel_build_env = .pkg
passenv =
    GITHUB_TOKEN
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-asyncio>=0.21.0
commands =
    pytest {posargs:tests/}

[testenv:lint]
description = Run code quality checks (black, ruff)
skip_install = true
deps =
    black>=23.7.0
    ruff>=0.0.280
commands =
    black --check src/ tests/
    ruff check src/ tests/

[testenv:format]
description = Format code with black
skip_install = true
deps =
    black>=23.7.0
commands =
    black src/ tests/

[testenv:type]
description = Run type checking with mypy
deps =
    mypy>=1.4.0
    types-pyyaml>=6.0.0
    types-requests>=2.31.0
commands =
    mypy src/

[testenv:unit]
description = Run unit tests only
commands =
    pytest -m unit {posargs:tests/unit/}

[testenv:integration]
description = Run integration tests only
commands =
    pytest -m integration {posargs:tests/integration/}

[testenv:dev]
description = Development environment with all dependencies
usedevelop = true
deps =
    {[testenv]deps}
    {[testenv:lint]deps}
    {[testenv:type]deps}
commands =
    python --version
    pip list
